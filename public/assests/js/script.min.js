function init(){conn.send("OpenChat initiated..!")}function SideBar(e){mobile("sidebar");var t=document.getElementById("message");if(null!=e){$("#message a").remove();for(var n=0;n<e.length;n++){var a=document.createElement("a"),i=document.createTextNode(e[n].name);a.appendChild(i),a.setAttribute("id",e[n].username),a.setAttribute("href","message.php#"+e[n].username),a.setAttribute("class","message"),a.setAttribute("onclick","newConversation(this,10)"),t.appendChild(a);var o=document.createElement("span"),s=document.createTextNode(e[n].time);if(o.appendChild(s),o.setAttribute("class","message_time"),a.appendChild(o),"1"==e[n].login_status){var r=document.createElement("div");r.setAttribute("class","online"),a.appendChild(r)}}}}function SidebarRequest(){conn.send("Load Sidebar")}function updateConversation(e){width()||SidebarRequest();var t=document.getElementById("conversation");if(1==e[0].type){if(t.innerHTML="",e[0].load>10){var n=$("<a></a>").text("Show Previous Message!"),a=$("<div></div>").append(n);$("#conversation").append(a),$("#conversation div").addClass("previous"),$("#conversation div a").attr({onclick:"previous(this)",id:e[0].username,name:e[0].load})}for(var i=e.length-1;i>=1;i--){var o=document.createElement("div");e[i].sent_by!=e[i].start?o.setAttribute("class","receiver"):o.setAttribute("class","sender"),t.appendChild(o);var s=document.createElement("br");s.setAttribute("style","clear:both;"),t.appendChild(s);var r=document.createElement("p"),c=document.createTextNode(e[i].message);r.appendChild(c),o.appendChild(r);var d=document.createElement("h6"),m=document.createTextNode(e[i].time);d.appendChild(m),d.setAttribute("class","message_time"),r.appendChild(d)}if($("#chat_heading a").remove("a"),n=$("<a></a>").text(e[0].name),$("#chat_heading").append(n),$("#chat_heading a").attr({href:"http://localhost/openchat/account.php/"+e[0].username}),"1"==e[0].login_status){var l=document.createElement("p");l.setAttribute("class","online"),$("#chat_heading a").append(l),$("#chat_heading a p").css({float:"right"})}width()?$(".text_icon #text_reply").attr({name:e[0].id}):$("#text_reply").attr({name:e[0].id}),t.scrollTop=t.scrollHeight}else t.innerHTML="",$("#chat_heading a").remove("a"),n=$("<a></a>").text(e[0].name),$("#chat_heading").append(n),$("#chat_heading a").attr({href:"http://localhost/openchat/account.php/"+e[0].username}),"1"==e[0].login_status&&(l=document.createElement("p"),l.setAttribute("class","online"),$("#chat_heading a").append(l),$("#chat_heading a p").css({float:"right"})),width()?$(".text_icon #text_reply").attr({name:e[0].id}):$("#text_reply").attr({name:e[0].id})}function newConversation(e,t){mobile("main"),$("#compose_selection").css("visibility","hidden"),flag=0,$("#compose_name").val(""),$("#search_item").val(""),$("#compose_text").hide();var n={username:e.id,load:t,newConversation:"Initiated"};conn.send(JSON.stringify(n))}function reply(){var e="";e=width()?".text_icon #text_reply":"#text_reply";var t=[$(e).val()],n=$(e).attr("name");$(e).val("");var a={name:n,reply:t};a=JSON.stringify(a),conn.send(a)}function compose(){mobile("compose"),flag=1,$("#chat_heading a").remove("a"),document.getElementById("conversation").innerHTML="",$("#compose_text").show()}function ComposeChoose(){var e=document.getElementById("compose_name").value;if(""!=e){var t={value:e,Compose:"Compose"};conn.send(JSON.stringify(t))}else $("#compose_selection").css("visibility","hidden")}function composeResult(e){var t=document.getElementById("suggestion");if(t.innerHTML="","Not Found"!=e)for(var n=e.length-1;n>=0;n--){var a=document.createElement("li"),i=document.createElement("a"),o=document.createTextNode(e[n].name);i.appendChild(o),i.setAttribute("href","#"),i.setAttribute("onclick","newConversation(this,10)"),i.setAttribute("class","suggestion"),i.setAttribute("id",e[n].username),a.appendChild(i),t.appendChild(a)}else{var s=$("<a></a>").text("Not Found"),r=$("<li></li>").append(s);$("#suggestion").append(r),$("#suggestion li a").attr({onclick:"myFunction()"})}$("#compose_selection").css("visibility","visible")}function search_choose(){var e=$("#search_item").val();if(""!=e){var t={value:e,search:"search"};conn.send(JSON.stringify(t))}else conn.send("Load Sidebar")}function searchResult(e){var t=document.getElementById("message");if("Not Found"!=e){t.innerHTML="";for(var n=e.length-1;n>=0;n--){var a=document.createElement("a"),i=document.createTextNode(e[n].name);a.appendChild(i),a.setAttribute("id",e[n].username),a.setAttribute("href","message.php#"+e[n].username),a.setAttribute("class","message"),a.setAttribute("onclick","newConversation(this,10)"),t.appendChild(a);var o=document.createElement("span"),s=document.createTextNode(e[n].time);o.appendChild(s),o.setAttribute("class","message_time"),a.appendChild(o)}}else{$("#message").text("");var r=$("<a></a>").text("Not Found");$("#message").append(r),$("#message a").addClass("message")}}function myFunction(){$("#compose_selection").css("visibility","hidden"),init(),flag=0,$("#compose_name").val(""),$("#search_item").val(""),$("#compose_text").hide()}function previous(e){mobile("previous");var t=(e.id,e.name);newConversation(e,t)}function mobile(e){width()&&(mob_hide(),"main"==e&&($(".sidebar").hide(),$(".mob-reply").show(),$(".chat_name").show(),$(".chat_name #chat_heading").show(),""==pre&&($(".main div").remove("div"),$(".main br").remove("br"),$(".chat_name #chat_heading a").remove("a")),$(".main").show()),"compose"==e&&($(".chat_name").show(),$(".chat_name .compose_text").show(),$(".sidebar").hide(),$("#compose_selection").show()),"sidebar"==e&&$(".sidebar").show(),pre="previous"==e?"1":"")}function show_search(){mob_hide(),$(".search_message").show(),$(".sidebar").show()}function mob_hide(){$(".search_message").hide(),$(".sidebar").hide(),$(".main").hide(),$(".chat_name").hide(),$(".mob-reply").hide()}function width(){return window.innerWidth<500}function startDictation(){if(window.hasOwnProperty("webkitSpeechRecognition")){var e=new webkitSpeechRecognition;e.continuous=!1,e.interimResults=!1,e.lang="en-IN",e.start(),e.onresult=function(t){document.getElementById("text_reply").value=t.results[0][0].transcript,e.stop(),reply()},e.onerror=function(){e.stop()}}}var flag=0,pre="",conn=new WebSocket("ws://localhost:8080");conn.onopen=function(){init()},conn.onmessage=function(e){var t=JSON.parse(e.data);console.log(t),width()||SideBar(t.sidebar),void 0!==t.initial&&SideBar(t.initial),void 0!==t.conversation&&updateConversation(t.conversation),void 0!==t.Search&&searchResult(t.Search),void 0!==t.Compose&&composeResult(t.Compose)},conn.onerror=function(e){},window.ondblclick=myFunction,console.log("Hello, Contact me at ankitjain28may77@gmail.com");